// Initial to mobile


//After Updating in mobile by to QC

db.cminspection.insert(

    {
        "userName": "TC920028",
        "status": "New Request",
        "year": 2020,
        "dateCreated": ISODate("2020-05-30T09:41:43.101Z"),
        "lastUpdated": ISODate("2020-05-30T09:41:43.101Z"),
        "quarterNumber": 4,
        "classRoom": [
            {
                "serialNumber": "CLASS_1"
            }
        ],
        "laboratory": [
            {
                "serialNumber": "HYBRID_1"
            },
            {
                "serialNumber": "LAB_1"
            }
        ],
        "centreArea": [
            {
                "type": "Reception"
            },
            {
                "type": "Placement & Entrepreneurship Cell"
            },
            {
                "type": "Male Washroom"
            },
            {
                "type": "Female Washroom"
            }
        ],
        "buildingStatus": "Educational Institute/ Any other Building",
        "totalMaleWashrooms": 1,
        "totalFeMaleWashrooms": 1,
        "questions": [
            {
                "question": "Is the Centre found on same address as provided in the CAAF form?",
                "ciAnswer": "yes",
                "questionPhoto": [
                    {
                        "ciimgurl": "Centre Inspector/CI_000004/assessor/1197ffe9-cb33-4b65-a083-b5f541189331_name.jpg",
                        "label": "Photos",
                        "longitude": "-122.0840197",
                        "latitude": "37.4220161",
                        "picTime": ISODate("2020-05-31T15:46:33.641Z")
                    }
                ],
                "ciComment": "All good"
            },
            {
                "question": "Is the Training Center building same as reported in CAAF?",
                "questionPhoto": [
                    {
                        "ciimgurl": "Centre Inspector/CI_000004/assessor/8d19285b-55eb-45c2-bf23-3f319505520d_name.jpg",
                        "label": "Photos",
                        "longitude": "-122.0840197",
                        "latitude": "37.4220161",
                        "picTime": ISODate("2020-05-31T15:47:03.273Z")
                    }
                ],
                "buildingStatus": "Educational Institute/ Any other Building",
                "ciComment": "Building not matched"
            },
            {
                "question": "Trainer's biometric attendance available?",
                "ciAnswer": "yes",
                "questionPhoto": [
                    {
                        "ciimgurl": "Centre Inspector/CI_000004/assessor/9e2a7b10-99d8-4f3c-a01f-80d96db35765_name.jpg",
                        "label": "Photos",
                        "longitude": "-122.0840197",
                        "latitude": "37.4220161",
                        "picTime": ISODate("2020-05-31T15:47:27.934Z")
                    }
                ],
                "ciComment": "All Ok"
            },
            {
                "question": "Is the number of classrooms same as reported in CAAF?",
                "ciAnswer": "no",
                "questionPhoto": [
                    {
                        "ciimgurl": "Centre Inspector/CI_000004/assessor/46e8ed68-313d-4404-870c-3ac2e6a94424_name.jpg",
                        "label": "Class Room Photos CLASS_1 View 1",
                        "longitude": "-122.0840197",
                        "latitude": "37.4220161",
                        "picTime": ISODate("2020-05-31T15:48:36.249Z")
                    },
                    {
                        "ciimgurl": "Centre Inspector/CI_000004/assessor/729e3b25-fc2f-4e9a-9762-5ef77375365c_name.jpg",
                        "label": "CLASS_1 View 2",
                        "longitude": "-122.0840197",
                        "latitude": "37.4220161",
                        "picTime": ISODate("2020-05-31T15:48:45.541Z")
                    }
                ],
                "ciComment": "All not good"
            },
            {
                "question": "Is the number of labs same as reported in CAAF?",
                "ciAnswer": "no",
                "questionPhoto": [
                    {
                        "ciimgurl": "Centre Inspector/CI_000004/assessor/aa980bd6-1363-404e-bcd3-5672f2efc88a_name.jpg",
                        "label": "Laboratory Photos HYBRID_1 View 1",
                        "longitude": "-122.0840197",
                        "latitude": "37.4220161",
                        "picTime": ISODate("2020-05-31T15:47:47.117Z")
                    },
                    {
                        "ciimgurl": "Centre Inspector/CI_000004/assessor/5da74b26-cadd-4f56-a130-eaab555eb99e_name.jpg",
                        "label": "HYBRID_1 View 2",
                        "longitude": "-122.0840197",
                        "latitude": "37.4220161",
                        "picTime": ISODate("2020-05-31T15:47:55.866Z")
                    },
                    {
                        "ciimgurl": "Centre Inspector/CI_000004/assessor/862460ba-f8fb-4bbf-aae7-34e9c0243785_name.jpg",
                        "label": "Laboratory Photos LAB_1 View 1",
                        "longitude": "-122.0840197",
                        "latitude": "37.4220161",
                        "picTime": ISODate("2020-05-31T15:48:04.552Z")
                    },
                    {
                        "ciimgurl": "Centre Inspector/CI_000004/assessor/034f3be1-8e1a-4424-bce5-d6252d4625fd_name.jpg",
                        "label": "LAB_1 View 2",
                        "longitude": "-122.0840197",
                        "latitude": "37.4220161",
                        "picTime": ISODate("2020-05-31T15:48:12.497Z")
                    }
                ],
                "ciComment": "All good"
            },
            {
                "question": "Is the centre area same as reported in the CAAF?",
                "ciAnswer": "yes",
                "questionPhoto": [
                    {
                        "ciimgurl": "Centre Inspector/CI_000004/assessor/394a50fa-a46b-4137-adca-03322c06e7a9_name.jpg",
                        "label": "Reception",
                        "longitude": "-122.0840197",
                        "latitude": "37.4220161",
                        "picTime": ISODate("2020-05-31T15:49:10.082Z")
                    },
                    {
                        "ciimgurl": "Centre Inspector/CI_000004/assessor/9871bf1e-c731-4ded-b86d-84fc524b26f4_name.jpg",
                        "label": "Placement & Entrepreneurship Cell",
                        "longitude": "-122.0840197",
                        "latitude": "37.4220161",
                        "picTime": ISODate("2020-05-31T15:49:17.348Z")
                    },
                    {
                        "ciimgurl": "Centre Inspector/CI_000004/assessor/de61d3f9-8a22-4a42-a107-11d78edd6e4b_name.jpg",
                        "label": "Male Washroom",
                        "longitude": "-122.0840197",
                        "latitude": "37.4220161",
                        "picTime": ISODate("2020-05-31T15:49:24.522Z")
                    },
                    {
                        "ciimgurl": "Centre Inspector/CI_000004/assessor/3c126857-7cf0-4c9b-9f36-82f7784e8fb2_name.jpg",
                        "label": "Female Washroom",
                        "longitude": "-122.0840197",
                        "latitude": "37.4220161",
                        "picTime": ISODate("2020-05-31T15:49:32.359Z")
                    }
                ],
                "ciComment": "ALl OK"
            },
            {
                "question": "Is the placement/entrepreneurship cell available?",
                "ciAnswer": "yes",
                "questionPhoto": [
                    {
                        "ciimgurl": "Centre Inspector/CI_000004/assessor/d0e025c0-d8fe-4678-ad7b-ea74ed905c81_name.jpg",
                        "label": "Photos",
                        "longitude": "-122.0840197",
                        "latitude": "37.4220161",
                        "picTime": ISODate("2020-05-31T15:49:57.294Z")
                    }
                ],
                "ciComment": "ALl ok"
            },
            {
                "question": "Availability of Separate Washroom for Male & Female?",
                "ciAnswer": "yes",
                "questionPhoto": [
                    {
                        "ciimgurl": "Centre Inspector/CI_000004/assessor/68d09af1-e3a4-45ff-9981-d542fca23aac_name.jpg",
                        "label": "Male Washroom",
                        "longitude": "-122.0840197",
                        "latitude": "37.4220161",
                        "picTime": ISODate("2020-05-31T15:50:18.097Z")
                    },
                    {
                        "ciimgurl": "Centre Inspector/CI_000004/assessor/24e460e2-43fd-4325-b343-be017fddd25a_name.jpg",
                        "label": "Female Washroom",
                        "longitude": "-122.0840197",
                        "latitude": "37.4220161",
                        "picTime": ISODate("2020-05-31T15:50:25.965Z")
                    }
                ],
                "ciComment": "All available"
            },
            {
                "question": "Are both male and female washrooms hygienically functional?",
                "ciAnswer": "yes",
                "questionPhoto": [
                    {
                        "ciimgurl": "Centre Inspector/CI_000004/assessor/d9e75e42-2c18-4c21-87f1-04fc4080f7dd_name.jpg",
                        "label": "Male Washroom",
                        "longitude": "-122.0840197",
                        "latitude": "37.4220161",
                        "picTime": ISODate("2020-05-31T15:50:44.531Z")
                    },
                    {
                        "ciimgurl": "Centre Inspector/CI_000004/assessor/a2ebd581-d550-408a-bfc2-25e9d345c107_name.jpg",
                        "label": "Female Washroom",
                        "longitude": "-122.0840197",
                        "latitude": "37.4220161",
                        "picTime": ISODate("2020-05-31T15:50:52.345Z")
                    }
                ],
                "ciComment": "Yes Hygiend"
            },
            {
                "question": "Required components available in the first aid box?",
                "ciAnswer": "no",
                "questionPhoto": [
                    {
                        "ciimgurl": "Centre Inspector/CI_000004/assessor/f2f5f9d3-905f-4f06-bbed-1fe8ac38a2ee_name.jpg",
                        "label": "Photos",
                        "longitude": "-122.0840197",
                        "latitude": "37.4220161",
                        "picTime": ISODate("2020-05-31T15:51:19.396Z")
                    }
                ],
                "ciComment": "Bandage not available"
            },
            {
                "question": "Availability of clean drinking water?",
                "ciAnswer": "yes",
                "questionPhoto": [
                    {
                        "ciimgurl": "Centre Inspector/CI_000004/assessor/027ce90e-4049-4c09-8004-abd6733b4505_name.jpg",
                        "label": "Photos",
                        "longitude": "-122.0840197",
                        "latitude": "37.4220161",
                        "picTime": ISODate("2020-05-31T15:51:38.297Z")
                    }
                ],
                "ciComment": "RO available"
            },
            {
                "question": "Availability of Housekeeping Staff, Checklist, Dustbin at all places?",
                "items": {
                    "checkList": true,
                    "dustBin": false,
                    "houseKeepingStaff": true
                },
                "questionPhoto": [
                    {
                        "ciimgurl": "Centre Inspector/CI_000004/assessor/c93c12e9-72e4-4ed5-b0a8-4bf0dc90db25_name.jpg",
                        "label": "Housekeeping Staff",
                        "longitude": "-122.0840197",
                        "latitude": "37.4220161",
                        "picTime": ISODate("2020-05-31T18:02:02.876Z")
                    },
                    {
                        "ciimgurl": "Centre Inspector/CI_000004/assessor/41da4b46-e4ee-4810-93d4-7edf0fecf400_name.jpg",
                        "label": "Check List",
                        "longitude": "-122.0840197",
                        "latitude": "37.4220161",
                        "picTime": ISODate("2020-05-31T18:02:13.326Z")
                    }
                ],
                "ciComment": "Dustbin not found"
            },
            {
                "question": "Availability of fire fighting equipment?",
                "ciAnswer": "no",
                "questionPhoto": [
                    {
                        "ciimgurl": "Centre Inspector/CI_000004/assessor/4cfe9c7a-39fd-4ed5-bc9e-78f5d8559412_name.jpg",
                        "label": "Photos",
                        "longitude": "-122.0840197",
                        "latitude": "37.4220161",
                        "picTime": ISODate("2020-05-31T16:09:01.461Z")
                    }
                ],
                "ciComment": "NOt  available"
            },
            {
                "question": "Final Remarks",
                "ciComment": "NOt  available"
            }
        ]
    }

)

db.cmStatusLog.remove({ tcUserName: "TC1500455" })
db.cmworkflow.remove({ tcId: "TC1500455" })
db.cminspection.remove({ userName: "TC1500455" })
db.tccontinuousmonitoring.remove({ userName: "TC1500455" })

db.trainingcentre.aggregate([
    //{ "$match": { userName: { "$in": [] } } },
    { "$group": { "_id": "$address.state.name", "stateCount": { "$sum": 1 } } },
])

db.trainingcentre.aggregate([
    {
        "$match": {
            "processType": "Accreditation & Affiliation", status: { "$nin": ["init", "TC_CREATED", "paymentAwaiting", "blocked", "Deactivated/blocked", "INACTIVE", "DEACCREDIATED", "applicationWithDrawl"] },
            "continuousMonitoringPayment": "success", "rating": { "$gte": 3 },
            "jobRoles.sscStatus": { "$in": ["Conditionally Accrediated", "Accrediated"] }
        }
    },
    { "$group": { "_id": "$address.state.name", "stateCount": { "$sum": 1 } } },

]).pretty()

db.trainingcentre.aggregate([
    { "$match": { userName: { "$in": ["TC920028", "TC1500455"] } } },
    { "$unwind": "$jobRoles" },
    { "$match": { "jobRoles.sscStatus": { "$in": ["Conditionally Accrediated", "Accrediated"] } } },
    { "$project": { "userName": 1, "schemeName": "$jobRoles.scheme.name" } },
    { "$group": { "_id": "$schemeName", "schemeCount": { "$sum": 1 }, "userName": { "$push": "$userName" } } },
]).pretty()

db.trainingcentre.aggregate([
    { "$match": { userName: { "$in": ["TC920028", "TC1500455"] } } },
    { "$unwind": "$jobRoles" },
    { "$match": { "jobRoles.sscStatus": { "$in": ["Conditionally Accrediated", "Accrediated"] } } },
    { "$project": { "userName": 1, "schemeName": "$jobRoles.scheme.name" } },
    { "$group": { "_id": { "schemeName": "$schemeName" }, "schemeCount": { "$sum": 1 }, "userName": { "$push": "$userName" } } },
]).pretty()

db.trainingcentre.aggregate([
    { "$match": { "continuousMonitoringPayment": "success", "rating": { "$gte": 3 }, status: "Qualified", "trainingPartner.userName": { "$exists": true } } },
    { "$unwind": "$jobRoles" },
    { "$match": { "jobRoles.sscStatus": { "$in": ["Conditionally Accrediated", "Accrediated"] } } },
    {
        "$project": {
            "userName": 1, "_id": 0, "schemeName": "$jobRoles.scheme.name",
            "rating": "$rating", "stateName": "$address.state.name",
            "qpCode": "$jobRoles.qp",
        }
    },
]).pretty()

db.smarttc_26jun2020.aggregate([
    {
        "$match": {
            "processType": "Accreditation & Affiliation", status: { "$nin": ["init", "TC_CREATED", "paymentAwaiting", "blocked", "Deactivated/blocked", "INACTIVE", "DEACCREDIATED", "applicationWithDrawl"] },
            "continuousMonitoringPayment": "success", "rating": { "$gte": 3 },
            "jobRoles.sscStatus": { "$in": ["Conditionally Accrediated", "Accrediated"] }
        }
    },
    { "$group": { "_id": "$address.state.name", "stateCount": { "$sum": 1 } } },
    {
        "$project": {
            "stateName": "$_id",
            "_id": 0,
            "stateCount": 1,
            //"tcIds": 1,
            "statePercentage": { "$multiply": [{ "$divide": ["$stateCount", 5905] }, 100] },
        }
    },

]).pretty()

db.cmassigninspectiondata.aggregate([

    { "$group": { "_id": "$stateName", "stateCount": { "$sum": 1 } } },
    {
        "$project": {
            "stateName": "$_id",
            "_id": 0,
            "stateCount": 1,
            //"tcIds": 1,
        }
    },

]).pretty()

db.smarttc_26jun2020.aggregate([
    {
        "$match": {
            "processType": "Accreditation & Affiliation", status: { "$nin": ["init", "TC_CREATED", "paymentAwaiting", "blocked", "Deactivated/blocked", "INACTIVE", "DEACCREDIATED", "applicationWithDrawl"] },
            "continuousMonitoringPayment": "success", "rating": { "$gte": 3 },
            "jobRoles.sscStatus": { "$in": ["Conditionally Accrediated", "Accrediated"] }
        }
    }])


db.smarttc_26jun2020.find({
    "processType": "Accreditation & Affiliation", status: { "$nin": ["init", "TC_CREATED", "paymentAwaiting", "blocked", "Deactivated/blocked", "INACTIVE", "DEACCREDIATED", "applicationWithDrawl"] },
    "continuousMonitoringPayment": "success", "rating": { "$gte": 3 },
    "jobRoles.sscStatus": { "$in": ["Conditionally Accrediated", "Accrediated"] }
}, { userName: 1, rating: 1, _id: 0 }).toArray()

//
a = db.trainingcentre.aggregate([
    { "$match": { "processType": "Accreditation & Affiliation" } },
    { "$unwind": "$jobRoles" },
    { "$match": { "jobRoles.scheme.name": { "$in": ["MIDH (Mission for Integrated Horticulture)", "RKVY (Rashtriya Krishi Vikas Yojna)"] } } },
    {
        "$project": {
            "userName": 1, "_id": 0, "qp": "$jobRoles.qp",

        }
    },
]).toArray()

a.forEach( data => {
    print(data["userName"])
})